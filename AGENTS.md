# AGENTS.md

## Cursor Cloud specific instructions

### 3OX Agent Boot Sequence

This repo IS a 3OX agent. The root `.3ox/` directory contains the full cube:

**On agent spin-up, read these files in order:**
1. `.3ox/_meta/SESSION.CHECKPOINT.toml` — resume anchor, truth paths, known drift
2. `.3ox/(1)Spark/Zens3n.sparkfile.md` — system identity, PRISM kernel, response contract
3. `.3ox/(2)Brains/brains.rs` — persona config (TOML), channels, limits

**The 6 Faces (numbered directories):**

| Face | Path | Purpose |
|------|------|---------|
| (1)Spark | `.3ox/(1)Spark/` | Sparkfile — system identity and behavior spec |
| (2)Brains | `.3ox/(2)Brains/` | Agent persona config (TOML format, not compiled Rust) |
| (3)Rules | `.3ox/(3)Rules/` | `limits.toml`, `write_policy.toml` |
| (4)Toolkit | `.3ox/(4)Toolkit/Tools/` | `tools.yml` — tool registry |
| (5)Links | `.3ox/(5)Links/` | `routes.json` — operation routing |
| (6)Pulse | `.3ox/(6)Pulse/` | Receipts, archives, skills |

**Vec3 Runtime (`_meta` + `.vec3` + `vec3/`):**
- `.3ox/_meta/` — `WHOAMI.md`, `CHANGELOG.toml`, `SESSION.CHECKPOINT.toml`, `NAMING.CONTRACT.toml`, `merkle.root`
- `.3ox/.vec3/` — runtime binaries, device bridges, library, variable state
- `.3ox/vec3/rc/` — lifecycle scanner (start.d, stop.d, status.d, run/)

**TRON Runtime:**
- TRON replaces cron with contract-governed runtime services
- Rulebook at `.3ox/.vec3/var/wrkdsk/5TRATA.LAYERING/HUB.PUBLISH/TRON.RUNTIME.RULEBOOK.md`
- Lifecycle scanner: `.3ox/vec3/rc/run/lifecycle.scanner.rb`
- Start: `bash .3ox/vec3/rc/start.d/lifecycle.scanner.sh`

**Cloud Agent cube (`!WORKDESK/CloudAgents/DebugAgent/`):**
- Pre-configured cloud agent with `.3ox/` and `.cursorrules`
- `.cursorrules` loads sparkfile as system context

### Codebase Overview

**ZENS3N** monorepo with **3OX.BUILDER** (Rust workspace + Bun + Ruby) at `3OX.Ai/3OX.BUILDER/`.

### Required Toolchain

- **Rust** (stable, >=1.81, edition 2021) — core build system
- **Bun** (>=1.0.0) — for `compile-run.bun` orchestrator
- **Ruby** (>=3.2.0) — agent runtime scripts, lifecycle scanner, vec3 tools
- **Elixir** (>=1.14) — inference bridge, warden, API modules in `.3ox/.vec3/`

### Build & Test Commands

All commands run from `3OX.Ai/3OX.BUILDER/`:

| Action | Command |
|--------|---------|
| Build all | `cargo build --release` |
| Build CLI only | `cargo build --release --bin 3ox` |
| Run tests | `cargo test` |
| Run Vec3Boot | `./target/release/vec3-boot [cube_path]` |
| Run 3ox CLI | `./target/release/3ox help` |
| Makefile targets | `make build`, `make test`, `make clean` |

See `3OX.Ai/3OX.BUILDER/README.md` for full documentation.

### Gotchas

- **`compile-run.bun` path bug**: References `./boot/target/release/vec3-boot` but binary is at `./target/release/vec3-boot`. Use direct cargo commands.
- **Vec3Boot is interactive**: 5-second splash + prompts. Pipe input or use `timeout` for non-interactive runs.
- **No lockfiles**: No `Cargo.lock` or `bun.lockb`. Dependencies resolve fresh each build.
- **Directories with `!` prefix**: Always quote paths (`'!ZEN.HUB'`, `'!WORKDESK'`, `'!CMD.CENTER'`).
- **Rust toolchain**: Run `rustup default stable` if cargo version is below 1.81.
- **Root `.3ox/` uses numbered face directories**: `(1)Spark/` through `(6)Pulse/`, plus `.vec3/rc/run/run.rb`. The boot loader resolves both layouts automatically.
- **`run.rb` location**: Root cube stores it at `.3ox/.vec3/rc/run/run.rb`, not flat `.3ox/run.rb`.
- **`_meta/merkle.root`**: Referenced in SESSION.CHECKPOINT but file may not exist yet on fresh clone — it's generated by the receipt system.
